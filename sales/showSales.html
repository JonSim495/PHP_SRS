<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Show all sales</title>
    <script>
      var xmlhttp = new XMLHttpRequest();
      var url = "show_sales_ajax.php";
      var myArr;
      xmlhttp.onreadystatechange = function(){
          if (this.readyState == 4 && this.status == 200){
	      myArr = JSON.parse(this.responseText);
	      go(myArr);
  	  }
      };
      xmlhttp.open("GET", url, true);
      xmlhttp.send(); 

      function go(arr){
         var out = "<tr>";
	 for (var i=0; i<arr.length; i++){
	     var salesID = arr[i].salesID;
	     var salesDate = arr[i].salesDate;
	     var invoice = arr[i].invoice;

	     var items = arr[i].itemInfo;
	     var totalAmount = 0, count = items.length;
	     out += "<td rowspan=\"" + count + "\">" + arr[i].salesID + "</td>";
	     out += "<td rowspan=\"" + count + "\">" + arr[i].salesDate + "</td>";
	     out += "<td rowspan=\"" + count + "\">" + arr[i].invoice + "</td>";

	     // for rowspan purpose
	     var name = [], inn = [];
	     for(var j=0; j<items.length; j++){
		 name.push("<td>" + items[j].itemName + "</td>");
		 inn.push("<td>" + items[j].itemCount + "</td>");
		 totalAmount += items[j].itemPrice * items[j].itemCount;
	     }

	     out += name[0] + inn[0]; //items and amount of purchase
	     out += "<td rowspan=\"" + count + "\">" + totalAmount + "</td>";
	     out += "<td rowspan=\"" + count + "\">Edit</td>";
	     out += "<td rowspan=\"" + count + "\">Delete</td>";

	     if (count>1){
	         for (var i=1; i<name.length; i++){
		     out += "</tr><tr>";
		     out += name[i] + inn[i];
		 }
	     }
	     out += "</tr>";
	 }
         document.getElementById("sales").innerHTML = out;
      }

      window.onload = go(myArr);
    </script>
  </head>

  <body>
    <h1>All sales items</h1>
    <table border="1em">
      <thead>
        <tr>
        <th>Sales ID</th>
        <th>Invoice Number</th>
        <th>Date</th>
        <th>Items</th>
        <th>Amount of purchase</th>
        <th>Total sales amount</th>
        <th>Edit</th>
        <th>Deletion</th>
	</tr>
      </thead>

      <tbody id="sales">
      </tbody>
    </table>
  </body>
</html>
